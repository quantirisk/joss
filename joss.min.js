// Copyright (c) Quantitative Risk Solutions PLT (201604001668)
// 
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// 
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.
// 
const e=function(){const e=new ArrayBuffer(2);new Uint16Array(e)[0]=65279;return 254===new Uint8Array(e)[0]?"BE":"LE"}(),r={Object:c,Array:c,Map:c,Set:c,DataView:l,Int8Array:l,Uint8Array:l,Uint8ClampedArray:l,Int16Array:l,Uint16Array:l,Int32Array:l,Uint32Array:l,Float16Array:l,Float32Array:l,Float64Array:l,BigInt64Array:l,BigUint64Array:l,Duration:u,PlainYearMonth:u,PlainMonthDay:u,PlainDate:u,PlainTime:u,PlainDateTime:u,Instant:u,ZonedDateTime:u,Date:function(e,r){O(e,Uint8Array.of(14)),o(e,r.valueOf())},RegExp:function(e,r){O(e,Uint8Array.of(15)),o(e,r.toString())},ArrayBuffer:f,SharedArrayBuffer:f,Boolean:a,Number:s,BigInt:i,String:f},t={hole:new Error("Encountered a hole in a sparse array"),ended:new Error("The serialized bytestream ended before the deserialization could complete successfully."),unused:new Error("The deserialization completed before the end of the serialized bytestream."),exceeded:new Error("The serialized bytestream exceeded the maximum acceptable length."),malformed:new Error("The serialized bytestream contained malformed byte sequences."),property:new Error("Encountered an undefined property of a collection."),collection:new Error("Encountered a collection in streaming mode.")};t.ended.name="ERR_ENDED",t.unused.name="ERR_UNUSED",t.exceeded.name="ERR_EXCEEDED",t.malformed.name="ERR_MALFORMED";export{n as serialize,w as deserialize,m as serializable,v as deserializable,E as deserializing};function n(r,t){const n={};if(void 0===t)t={};else if("object"!=typeof t)throw new TypeError("The options parameter must be an object.");if(!1===t.hasOwnProperty("endian"))n.endian=e;else{if("LE"!==t.endian&&"BE"!==t.endian)throw new RangeError('The endian option must be either "LE" or "BE".');n.endian=t.endian}return n.bytes=[],n.length=0,n.record=new Map,n.method="static",o(n,r),P(n.bytes,n.length)}function o(e,t){switch(typeof t){case"object":if(null!==t){const n=t.constructor.name,o=r[n];return void 0!==o&&(o!==u||t instanceof Temporal[n])?!1===e.record.has(t)?(e.record.set(t,e.length),o(e,t,n)):h(e,t):O(e,Uint8Array.of(13))}return O(e,Uint8Array.of(0));case"undefined":return O(e,Uint8Array.of(1));case"boolean":return a(e,t);case"number":return s(e,t);case"bigint":return i(e,t);case"string":return f(e,t);default:O(e,Uint8Array.of(13))}}function a(e,r,t){void 0===t?O(e,!0===r?Uint8Array.of(2):Uint8Array.of(4)):!0===r.valueOf()?O(e,Uint8Array.of(3)):O(e,Uint8Array.of(5))}function s(e,r,t){let n,o,a;if(n=32,void 0===t){if(a=r,!isFinite(a))return O(e,a===1/0?Uint8Array.of(6):a===-1/0?Uint8Array.of(8):Uint8Array.of(10))}else{if(a=r.valueOf(),!isFinite(a))return O(e,a===1/0?Uint8Array.of(7):a===-1/0?Uint8Array.of(9):Uint8Array.of(11));n|=16}Math.floor(a)===a&&Math.abs(a)<=Number.MAX_SAFE_INTEGER?((a<0||0===a&&1/a==-1/0)&&(n|=8),o=y(Math.abs(a))):(o=new Uint8Array(new ArrayBuffer(8)),new DataView(o.buffer,o.byteOffset,o.byteOffset+o.length).setFloat64(0,a,!0)),O(e,Uint8Array.of(n|o.length-1)),O(e,o)}function i(e,r,t){let n,o,a;n=64,void 0===t?a=r:(a=r.valueOf(),n|=16),a>=0?o=d(a):(n|=8,o=d(-a));const s=y(o.length);O(e,Uint8Array.of(n|s.length-1)),O(e,s),O(e,o)}function f(e,r,t,n,o){let a,s;a=96,void 0===t?s=b(r):"String"===t?(a|=8,s=b(r.valueOf())):(a|="ArrayBuffer"===t?16:24,s=new Uint8Array(r,n||0,o||r.byteLength));const i=y(s.length);O(e,Uint8Array.of(a|i.length-1)),O(e,i),O(e,s)}function c(e,r,n){if("stream"===e.method)throw t.collection;let a;if(a=128,"Array"===n){const t=y(r.length),n=k(r);if(void 0!==n.nslot){a=160;const s=n.nslot,i=y(s);O(e,Uint8Array.of(a|t.length-1<<2|i.length-1)),O(e,t),O(e,i);for(let t=0;t<s;t+=1)r.hasOwnProperty(t)?o(e,r[t]):O(e,Uint8Array.of(12))}else if(void 0!==n.nelement){a=160;const s=y(n.nelement);O(e,Uint8Array.of(16|a|t.length-1<<2|s.length-1)),O(e,t),O(e,s),r.forEach((function(r,t){o(e,t),o(e,r)}))}else{y(r.length);O(e,Uint8Array.of(a|t.length-1)),O(e,t),r.forEach((function(r){o(e,r)}))}}else if("Object"===n){const t=y(Object.keys(r).length);O(e,Uint8Array.of(8|a|t.length-1)),O(e,t);for(let t in r)r.hasOwnProperty(t)&&(o(e,t),o(e,r[t]))}else if("Map"===n){const t=y(r.size);O(e,Uint8Array.of(16|a|t.length-1)),O(e,t),r.forEach((function(r,t){o(e,t),o(e,r)}))}else{const t=y(r.size);O(e,Uint8Array.of(24|a|t.length-1)),O(e,t),r.forEach((function(r){o(e,r)}))}}function l(r,t,n){let o,a,s,i;if(o=192,"BE"===r.endian&&(o|=16),r.endian!==e&&t.BYTES_PER_ELEMENT>1){switch(a=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength),t.BYTES_PER_ELEMENT){case 2:a=T(a);break;case 4:a=j(a);break;case 8:a=S(a)}s=0,i=a.byteLength}else a=t.buffer,s=t.byteOffset,i=t.byteLength;O(r,Uint8Array.of(o|["DataView","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array","Float16Array"].indexOf(n))),!1===r.record.has(a)?(r.record.set(a,r.length),f(r,a,a.constructor.name,s,i)):h(r,a)}function u(e,r,t){let n;n=224;O(e,Uint8Array.of(224|["Duration","PlainYearMonth","PlainMonthDay","PlainDate","PlainTime","PlainDateTime","Instant","ZonedDateTime"].indexOf(t))),o(e,r.toString())}function h(e,r){O(e,Uint8Array.of(29)),s(e,e.record.get(r))}function y(e){const r=[];for(;e>255;)r.push(255&e),e=Math.floor(e/256);return r.push(e),Uint8Array.from(r)}function d(e){const r=[],t=BigInt(8),n=BigInt(255);for(;e>n;)r.push(Number(e&n)),e>>=t;return r.push(Number(e)),Uint8Array.from(r)}function b(e){try{return(new TextEncoder).encode(e)}catch(r){let t=0;const n=[],o=e.length;for(;t<o;){let r=e.charCodeAt(t++);if(r<=127)n.push(r);else if(r<=2047)n.push(r>>6&31|192),n.push(63&r|128);else if(r<=55295||r>=57344&&r<=65535)n.push(r>>12&15|224),n.push(r>>6&63|128),n.push(63&r|128);else{const o=r,a=e.charCodeAt(t++);if(o<55296||o>56319)continue;if(a<56320||a>57343)continue;r=(1023&o)<<10|1023&a,r+=65536,n.push(r>>18&7|240),n.push(r>>12&63|128),n.push(r>>6&63|128),n.push(63&r|128)}}return Uint8Array.from(n)}}function m(r,n){const a={};if(void 0===n)n={};else if("object"!=typeof n)throw new TypeError("The options parameter must be an object.");if(!1===n.hasOwnProperty("endian"))a.endian=e;else{if("LE"!==n.endian&&"BE"!==n.endian)throw new RangeError('The endian option must be either "LE" or "BE".');a.endian=n.endian}a.length=0,a.record=new Map,a.method="stream";const s=[],i=[],f=[],c=Symbol(),l=Symbol(),u=Symbol();return new ReadableStream({start:function(e){s.push(0),i.push({root:r}),f.push(h(i[0]))},pull:function(e){let r=0,n=i.length-1;a.bytes=[];for(;r<16384&&n>=0;){const e=a.length,d=s[n],b=i[n],m=f[n].next();if(0===d){let e;e=128;const r=b.constructor.name;if("Array"===r){const r=y(b.length);if(b.hasOwnProperty(l)){e=160;const t=y(b[l]);O(a,Uint8Array.of(e|r.length-1<<2|t.length-1)),O(a,r),O(a,t)}else if(b.hasOwnProperty(u)){e=160;const t=y(b[u]);O(a,Uint8Array.of(16|e|r.length-1<<2|t.length-1)),O(a,r),O(a,t)}else{y(b.length);O(a,Uint8Array.of(e|r.length-1)),O(a,r)}}else if("Object"===r&&0!==n){const r=y(b[c]);O(a,Uint8Array.of(8|e|r.length-1)),O(a,r)}else if("Map"===r){const r=y(b.size);O(a,Uint8Array.of(16|e|r.length-1)),O(a,r)}else if("Set"===r){const r=y(b.size);O(a,Uint8Array.of(24|e|r.length-1)),O(a,r)}}if(!1===m.done){if(2!==d){const e=m.value,r=b.constructor.name;if("Array"===r&&b.hasOwnProperty(u))o(a,e);else if("Object"===r&&0!==n)o(a,e);else if("Map"===r)try{o(a,e)}catch(r){if(r!==t.collection)throw r;s.push(0),i.push(e),f.push(h(e))}s[n]=2}else if(2===d){const e=m.value;if(e!==t.hole)try{o(a,e)}catch(r){if(r!==t.collection)throw r;s.push(0),i.push(e),f.push(h(e))}else b.hasOwnProperty(l)&&O(a,Uint8Array.of(12));s[n]=1}}else delete b[u],delete b[l],delete b[c],s.pop(),i.pop(),f.pop();r+=a.length-e,n=i.length-1}0!==a.bytes.length?e.enqueue(P(a.bytes)):n>=0?this.pull(e):e.close()}});function h(e){let r,n,o,a;n="key";const s=e.constructor.name;if("Array"===s){a=e.keys();const r=k(e);void 0!==r.nslot?Object.defineProperty(e,l,{configurable:!0,value:r.nslot}):void 0!==r.nelement&&Object.defineProperty(e,u,{configurable:!0,value:r.nelement})}else"Object"===s?(a=Object.keys(e),Object.defineProperty(e,c,{configurable:!0,value:a.length}),o=-1):"Map"!==s&&"Set"!==s||(a=e.keys());return{next:function(){if("key"===n){if(n="value",void 0===o){let t=a.next();if(e.hasOwnProperty(u))for(;!1===e.hasOwnProperty(t.value)&&!1===t.done;)t=a.next();return!1===t.done?(r=t.value,e.hasOwnProperty(l)&&r>=e[l]?{value:void 0,done:!0}:{value:r,done:!1}):{value:void 0,done:!0}}return o+=1,void 0!==a[o]?(r=a[o],{value:r,done:!1}):{value:void 0,done:!0}}if(n="key","Array"===s)return e.hasOwnProperty(r)?{value:e[r],done:!1}:{value:t.hole,done:!1};if("Object"===s)return{value:e[r],done:!1};if("Map"===s)return{value:e.get(r),done:!1};if("Set"===s)return{value:r,done:!1}}}}}function w(e){if("object"!=typeof e||"Uint8Array"!==e.constructor.name)throw new TypeError("The bytes parameter must be a Uint8Array.");if(0===e.length)return;const r={};r.map=new Map,r.bytes=e,r.cursor=0,r.offset=0,r.method="static";const n=p(r);if(r.cursor!==r.bytes.length)throw t.unused;return n}function p(r){const n=r.bytes[r.cursor];if(void 0===n)throw t.ended;if(n<=13){let e;switch(r.cursor++,r.offset++,n){case 0:return null;case 1:return;case 2:return!0;case 3:e=new Boolean(!0);break;case 4:return!1;case 5:e=new Boolean(!1);break;case 6:return 1/0;case 7:e=new Number(1/0);break;case 8:return-1/0;case 9:e=new Number(-1/0);break;case 10:return NaN;case 11:e=new Number(NaN);break;case 12:return t.hole;case 13:return new ReferenceError}return r.map.set(r.offset-1,e),e}if(n<=31)switch(n){case 14:return function(e){const r=e.offset;e.cursor++,e.offset++;try{if(!1===function(e){const r=e.bytes[e.cursor];if(void 0===r)throw t.ended;return r>>5==1&&!(r>>4&1)||10===r}(e))throw t.malformed;const n=new Date(p(e));return e.map.set(r,n),n}catch(r){throw r===t.ended?(e.cursor--,e.offset--,r):r}}(r);case 15:return function(e){const r=e.offset;e.cursor++,e.offset++;try{if(!1===x(e))throw t.malformed;const n=p(e),o=n.lastIndexOf("/");if("/"!==n[0]||o<=0)throw t.malformed;const a=new RegExp(n.slice(1,o),n.slice(o+1));return e.map.set(r,a),a}catch(r){throw r===t.ended?(e.cursor--,e.offset--,r):r}}(r);case 29:return function(e){e.cursor++,e.offset++;try{if(!1===B(e))throw t.malformed;const r=p(e);if(!1===e.map.has(r))throw t.malformed;return e.map.get(r)}catch(r){throw r===t.ended?(e.cursor--,e.offset--,r):r}}(r);default:throw t.malformed}else switch(n>>5){case 1:return function(e){let r,n=e.cursor;const o=e.bytes[n++],a=1+(7&o);if(n+a>e.bytes.length)throw t.ended;if(a<8){if(7===a&&e.bytes[n+6]>31)throw t.malformed;r=g(e.bytes.subarray(n,n+=a)),1==(o>>3&1)&&(r*=-1)}else{const t=e.bytes.subarray(n,n+=a);r=new DataView(t.buffer,t.byteOffset,t.length).getFloat64(0,!0)}1==(o>>4&1)&&(r=new Number(r),e.map.set(e.offset,r));return e.cursor+=a+1,e.offset+=a+1,r}(r);case 2:return function(e){let r,n=e.cursor;const o=e.bytes[n++],a=1+(7&o);if(n+a>e.bytes.length)throw t.ended;const s=g(e.bytes.subarray(n,n+=a));if(n+s>e.bytes.length)throw t.ended;r=function(e){const r=BigInt(0),t=BigInt(8);let n=r,o=r;return e.forEach((function(e){n+=BigInt(e)<<o,o+=t})),n}(e.bytes.subarray(n,n+=s)),1==(o>>3&1)&&(r*=BigInt(-1));1==(o>>4&1)&&(r=new Object(r),e.map.set(e.offset,r));return e.cursor+=a+s+1,e.offset+=a+s+1,r}(r);case 3:return function(e){let r,n=e.cursor;const o=e.bytes[n++],a=1+(7&o);if(n+a>e.bytes.length)throw t.ended;const s=g(e.bytes.subarray(n,n+=a));if(n+s>e.bytes.length)throw t.ended;switch(o>>3&3){case 0:r=A(e.bytes,n,n+=s);break;case 1:r=new String(A(e.bytes,n,n+=s)),e.map.set(e.offset,r);break;case 2:r=new ArrayBuffer(s),e.map.set(e.offset,r),new Uint8Array(r).set(e.bytes.subarray(n,n+=s));break;case 3:r=new SharedArrayBuffer(s),e.map.set(e.offset,r),new Uint8Array(r).set(e.bytes.subarray(n,n+=s))}return e.cursor+=a+s+1,e.offset+=a+s+1,r}(r);case 4:return function(e){if("stream"===e.method)throw t.collection;let r,n=e.cursor;const o=e.bytes[n++],a=e.bytes.length,s=1+(7&o);if(n+s>a)throw t.ended;const i=g(e.bytes.subarray(n,n+=s));switch(o>>3&3){case 0:r=[],e.map.set(e.offset,r),e.cursor+=s+1,e.offset+=s+1;for(let n=0;n<i;n+=1){if(M(e))throw t.malformed;r.push(p(e))}return r;case 1:r={},e.map.set(e.offset,r),e.cursor+=s+1,e.offset+=s+1;for(let n=0;n<i;n+=1){if(!1===x(e))throw t.malformed;const n=p(e);if(r.hasOwnProperty(n))throw t.malformed;if(M(e))throw t.malformed;r[n]=p(e)}return r;case 2:r=new Map,e.map.set(e.offset,r),e.cursor+=s+1,e.offset+=s+1;for(let n=0;n<i;n+=1){const n=p(e);if(r.has(n))throw t.malformed;if(M(e))throw t.malformed;r.set(n,p(e))}return r;case 3:r=new Set,e.map.set(e.offset,r),e.cursor+=s+1,e.offset+=s+1;for(let n=0;n<i;n+=1){if(M(e))throw t.malformed;const n=p(e);if(r.has(n))throw t.malformed;r.add(n)}return r}}(r);case 5:return function(e){if("stream"===e.method)throw t.collection;let r=e.cursor;const n=e.bytes[r++],o=e.bytes.length,a=1+(n>>2&3);if(r+a>o)throw t.ended;const s=g(e.bytes.subarray(r,r+=a)),i=new Array(s),f=1+(3&n);if(r+f>o)throw t.ended;const c=g(e.bytes.subarray(r,r+=f));if(e.map.set(e.offset,i),e.cursor+=a+f+1,e.offset+=a+f+1,n>>4&1){for(let r=0;r<c;r+=1){if(!1===B(e))throw t.malformed;const r=p(e);if(r>=s)throw t.malformed;if(i.hasOwnProperty(r))throw t.malformed;if(M(e))throw t.malformed;i[r]=p(e)}return i}for(let r=0;r<c;r+=1){const n=p(e);n!==t.hole&&(i[r]=n)}return i}(r);case 6:return function(r){const n=r.offset,o=r.bytes[r.cursor],a=e!==(o>>4&1?"BE":"LE"),s=15&o;r.cursor++,r.offset++;try{let e;if(!1===function(e){const r=e.bytes[e.cursor];if(void 0===r)throw t.ended;return r>>5==3&&(r>>3&3)>=2}(r))throw t.malformed;const o=p(r);switch(s){case 0:e=new DataView(o);break;case 1:e=new Int8Array(o);break;case 2:e=new Uint8Array(o);break;case 3:e=new Uint8ClampedArray(o);break;case 4:e=a?new Int16Array(T(o.slice())):new Int16Array(o);break;case 5:e=a?new Uint16Array(T(o.slice())):new Uint16Array(o);break;case 6:e=a?new Int32Array(j(o.slice())):new Int32Array(o);break;case 7:e=a?new Uint32Array(j(o.slice())):new Uint32Array(o);break;case 8:e=a?new Float32Array(j(o.slice())):new Float32Array(o);break;case 9:e=a?new Float64Array(S(o.slice())):new Float64Array(o);break;case 10:e=a?new BigInt64Array(S(o.slice())):new BigInt64Array(o);break;case 11:e=a?new BigUint64Array(S(o.slice())):new BigUint64Array(o);break;case 12:e=a?new Float16Array(T(o.slice())):new Float16Array(o);break;default:throw t.malformed}return r.map.set(n,e),e}catch(e){throw e===t.ended?(r.cursor--,r.offset--,e):e}}(r);case 7:return function(e){const r=e.offset,n=e.bytes[e.cursor],o=7&n;e.cursor++,e.offset++;try{let n;if(!1===x(e))throw t.malformed;const a=p(e);switch(o){case 0:n=Temporal.Duration.from(a);break;case 1:n=Temporal.PlainYearMonth.from(a);break;case 2:n=Temporal.PlainMonthDay.from(a);break;case 3:n=Temporal.PlainDate.from(a);break;case 4:n=Temporal.PlainTime.from(a);break;case 5:n=Temporal.PlainDateTime.from(a);break;case 6:n=Temporal.Instant.from(a);break;case 7:n=Temporal.ZonedDateTime.from(a);break;default:throw t.malformed}return e.map.set(r,n),n}catch(r){throw r===t.ended?(e.cursor--,e.offset--,r):r}}(r)}}function g(e){let r=0,t=0;return e.forEach((function(e){r+=e*Math.pow(2,t),t+=8})),r}function A(e,r,t){try{return new TextDecoder("utf-8").decode(e.subarray(r,t))}catch(n){let o=r,a="";for(;o<t;){let r;if(0===e[o])break;if(128&e[o])if(192==(224&e[o])&&o+1<t)r=(31&e[o++])<<6|63&e[o++],a+=String.fromCharCode(r);else if(224==(240&e[o])&&o+2<t)r=(15&e[o++])<<12|(63&e[o++])<<6|63&e[o++],a+=String.fromCharCode(r);else{if(!(240==(248&e[o])&&o+3<t))break;if(r=(7&e[o++])<<18|(63&e[o++])<<12|(63&e[o++])<<6|63&e[o++],r>65535){r-=65536;const e=r>>>10&1023|55296,t=1023&r|56320;a+=String.fromCharCode(e,t)}else a+=String.fromCharCode(r)}else a+=String.fromCharCode(e[o++])}return a}}function v(e){let r;if(void 0===e)e={};else if("object"!=typeof e)throw new TypeError("The options parameter must be an object.");if(!1===e.hasOwnProperty("maxlength"))r=1073741824;else{if(!("number"==typeof e.maxlength&&e.maxlength>0))throw new RangeError("The maxlength option must be a positive integer.");r=e.maxlength}const t=U(r),n=new WritableStream(t);return t.stream=n,n}function E(e,r){let t;if(void 0===r)r={};else if("object"!=typeof r)throw new TypeError("The options parameter must be an object.");if(!1===r.hasOwnProperty("maxlength"))t=1073741824;else{if(!("number"==typeof r.maxlength&&r.maxlength>0))throw new RangeError("The maxlength option must be a positive integer.");t=r.maxlength}if("object"==typeof e){if(void 0!==e[Symbol.asyncIterator]){const r=e[Symbol.asyncIterator](),n=U(t);return n.start(),new Promise((function(e,t){r.next().then((function o(a){!1===a.done?(n.write(a.value),r.next().then(o).catch(t)):e(n.close())})).catch(t)}))}if("ReadableStream"===e.constructor.name){const r=e.getReader(),n=U(t);return n.start(),new Promise((function(e,t){r.read().then((function o(a){!1===a.done?(n.write(a.value),r.read().then(o).catch(t)):e(n.close())})).catch(t)}))}throw new TypeError("The readable parameter must be a readable stream or async iterable.")}throw new TypeError("The readable parameter must be a readable stream or async iterable.")}function U(e){const r={},n=[{}],o=Symbol(),a=Symbol(),s=Symbol(),i=Symbol(),f=Symbol(),c=Symbol();return{start:function(e){r.map=new Map,r.bytes=new Uint8Array(0),r.cursor=0,r.offset=0,r.length=0,r.method="stream",Object.defineProperty(n[0],a,{configurable:!0,value:1}),Object.defineProperty(n[0],o,{configurable:!0,writable:!0,value:0}),Object.defineProperty(n[0],s,{configurable:!0,writable:!0,value:"root"})},close:function(e){if(r.bytes.length>0){if(void 0===e)throw t.unused;e.error(t.unused)}else{const e=n[0].root;if(delete n[0].root,void 0===this.stream)return e;this.stream.result=e,delete this.stream}},write:function(h,y){let d;if((r.length+=h.length)<=e){r.bytes=P([r.bytes,h]);const e=r.bytes.length;let y=n.length-1;for(;y>=0;){const h=n[y],b=u(h);if(b===t.property)try{if(r.cursor+1>e)break;let a=p(r);if(a!==t.hole){if(l(h,a),0===y)break;if(n.pop(),n[y-1][s]===f){if(n[y-1].has(b))throw t.malformed;n[y-1][s]=a}}else{if("A"!==h[i])throw t.malformed;h[o]++,n.pop()}}catch(n){if(n!==t.collection){n!==t.ended&&(d=n);break}{let t=r.cursor;const n=r.bytes[t++];if(n>>5==4){let i;const f=1+(7&n);if(t+f>e)break;const c=g(r.bytes.subarray(t,t+=f));switch(n>>3&3){case 0:i=[];break;case 1:i={};break;case 2:i=new Map;break;case 3:i=new Set}Object.defineProperty(i,a,{configurable:!0,value:c}),Object.defineProperty(i,o,{configurable:!0,writable:!0,value:0}),Object.defineProperty(i,s,{configurable:!0,writable:!0,value:void 0}),l(h,i),r.map.set(r.offset,i),r.cursor+=f+1,r.offset+=f+1}else if(n>>5==5){const f=1+(n>>2&3);if(t+f>e)break;const c=g(r.bytes.subarray(t,t+=f)),u=new Array(c),y=1+(3&n);if(t+y>e)break;const d=g(r.bytes.subarray(t,t+=y));Object.defineProperty(u,a,{configurable:!0,value:d}),Object.defineProperty(u,o,{configurable:!0,writable:!0,value:0}),Object.defineProperty(u,s,{configurable:!0,writable:!0,value:void 0}),Object.defineProperty(u,i,{configurable:!0,value:n>>4&1?"B":"A"}),l(h,u),r.map.set(r.offset,u),r.cursor+=f+y+1,r.offset+=f+y+1}}}else if(b[o]<b[a]){const e=b.constructor.name;if("Array"===e)if("B"!==b[i])b[s]=b[o],n.push(b);else try{if(!1===B(r))throw t.malformed;const e=p(r);if(e>=b.length)throw t.malformed;if(b.hasOwnProperty(e))throw t.malformed;b[s]=e,n.push(b)}catch(e){e!==t.ended&&(d=e);break}else if("Object"===e)try{if(!1===x(r))throw t.malformed;const e=p(r);if(b.hasOwnProperty(e))throw t.malformed;b[s]=e,n.push(b)}catch(e){e!==t.ended&&(d=e);break}else if("Map"===e){b[s]=f,n.push(b);const e={};Object.defineProperty(e,a,{configurable:!0,value:1}),Object.defineProperty(e,o,{configurable:!0,writable:!0,value:0}),Object.defineProperty(e,s,{configurable:!0,writable:!1,value:"root"}),n.push(e)}else"Set"===e&&(b[s]=c,n.push(b))}else{if(delete b[i],delete b[s],delete b[o],delete b[a],0===y)break;if(n.pop(),n[y-1][s]===f){if(n[y-1].has(b))throw t.malformed;n[y-1][s]=b}}y=n.length-1}void 0===d&&(r.bytes=r.bytes.slice(r.cursor),r.cursor=0)}else d=t.exceeded;if(void 0!==d){if(void 0===y)throw d;y.error(d)}}};function l(e,r){const n=e.constructor.name;if("Array"===n)e.hasOwnProperty(i)?(e[e[s]]=r,e[o]++):(e.push(r),e[o]++);else if("Object"===n)e[e[s]]=r,e[o]++;else if("Map"===n)e.set(e[s],r),e[o]++;else if("Set"===n){if(e.has(r))throw t.malformed;e.add(r),e[s]=r,e[o]++}}function u(e){const r=e[s],n=e.constructor.name;return"Array"===n||"Object"===n?e.hasOwnProperty(r)?e[r]:t.property:"Map"===n?e.has(r)?e.get(r):t.property:"Set"===n?e.has(r)?r:t.property:void 0}}function O(e,r){e.bytes.push(r),e.length+=r.length}function P(e,r){let t=0,n=0;void 0===r?e.forEach((function(e){t+=e.length})):t=r;const o=new Uint8Array(t);return e.forEach((function(e){o.set(e,n),n+=e.length})),o}function k(e){let r=0,t=0,n=0,o=0,a=-1;e.forEach((function(e,s){a=s,s<=65535?s<=255?r++:t++:s<=1677215?n++:o++})),a+=1;const s=r+t+n+o;if(s===e.length)return{};return a-s<=2*r+3*t+4*n+5*o?{nslot:a}:{nelement:s}}function T(e){const r=new Uint8Array(e);for(let e=0,t=r.length;e<t;e+=2){const t=r[e];r[e]=r[e+1],r[e+1]=t}return e}function j(e){const r=new Uint8Array(e);for(let e=0,t=r.length;e<t;e+=4)for(let t=0;t<2;t+=1){const n=r[e+t];r[e+t]=r[e+3-t],r[e+3-t]=n}return e}function S(e){const r=new Uint8Array(e);for(let e=0,t=r.length;e<t;e+=8)for(let t=0;t<4;t+=1){const n=r[e+t];r[e+t]=r[e+7-t],r[e+7-t]=n}return e}function B(e){const r=e.bytes[e.cursor];if(void 0===r)throw t.ended;return!(r>>5!=1||r>>4&1||r>>3&1)}function M(e){const r=e.bytes[e.cursor];if(void 0===r)throw t.ended;return 12===r}function x(e){const r=e.bytes[e.cursor];if(void 0===r)throw t.ended;return r>>5==3&&!(r>>3&3)}